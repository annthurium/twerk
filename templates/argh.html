{% extends "layout.html" %}
{% block body %}

<style>
body {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: auto;
  position: relative;
  width: 960px;
}

</style>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>

    // x is time
    // y is value
    // data
/*
    
    var layers = [
    
      { 
        "name": "primary",
        "values": [
          { "x": 0, "y":  91},
          { "x": 1, "y": 290},
          { "x": 2, "y": 100},
          { "x": 3, "y": 80}
        ]
      },
      
      {  
        "name": "secondary",
        "values": [
          { "x": 0, "y":  9},
          { "x": 1, "y": 49},
          { "x": 2, "y": 100},
          { "x": 3, "y": 120}
        ]
      },
      {  
        "name": "emotions",
        "values": [
          { "x": 0, "y":  9},
          { "x": 1, "y": 49},
          { "x": 2, "y": 100},
          { "x": 3, "y": 120}
        ]
      },
    ];

var m = 4
*/


var layers = {{ data|safe }}

var m = layers[0].values.length // number of samples per layer

// width and height got flipped somehow? Find and fix this.
var width = 900,
    height = 500,
    mx = m - 1,
    my = 350;

var xScale = d3.scale.linear()
				.domain([0, layers[0].values.length])
				.range([0, width]);

// create array with sum of y values for each x point?

/*
function findRange(layers) {
	var count = Array(m)
	for (var i = 0; i < m; i++) {
		count[i] = 0
	}

	for (var i = 0; i < m; i++) {
		for (var j = 0; j < m; j++) {
			count[j] += layer[i].values[j] 
		}
	}
	var value = count[0]
	for (var i = 1; i < m; i++) {
		if count[i] > value: {
			value = count[i]
		}
	}
	return value
}
*/

var yScale = d3.scale.linear()
                     .domain([0, d3.max(layers.values, function(d) {return d.y})])
                     .range([0, height]);

// creates a values accessor for each layer
var stack = d3.layout.stack()
    .offset("wiggle")
    .values(function(d) { return d.values; });


var area = d3.svg.area()
    .x(function(d) { return d.x * width / mx; })
    // y0 is the baseline value
    .y0(function(d) { return height - d.y0 * height / my; })
    .y1(function(d) { return height - (d.y + d.y0) * height / my;});
    //.interpolate('basis');

  var svg = d3.select("body")
  .append("svg")
    .attr("width", width)
    .attr("height", height);

var color = d3.scale.linear()
    // what is the middle argument doing? is it the midpoint?
    .range(["#aad", "#609", "e0f"]);

/*
var area = d3.svg.area()
    .x(function(d) { return x(d.x); })
    .y0(function(d) { return y(d.y0); })
    //.y1(function(d) { return y(d.y0  d.y); });
*/

svg.selectAll("path")
    .data(stack(layers))
  .enter()
  .append("path")
    .attr("d", function(d) {
      return area(d.values); //
    })
  .style("fill", function() { 
    return color(Math.random()); 
  })
  .append("title")
    .text(function(d) { 
      return d.name; 
    });
</script>

{% endblock %}